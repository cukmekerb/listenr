"use strict";

var _setup = require("./setup");

var _compress = require("./compress");

var _compressInMemory = require("./compressInMemory");

/*!
 * node-minify
 * Copyright(c) 2011-2020 Rodolphe Stoclin
 * MIT Licensed
 */

/**
 * Module dependencies.
 */

/**
 * Run node-minify.
 *
 * @param {Object} settings - Settings from user input
 */
const minify = settings => {
  return new Promise((resolve, reject) => {
    const method = settings.content ? _compressInMemory.compressInMemory : _compress.compress;
    settings = (0, _setup.setup)(settings);

    if (!settings.sync) {
      method(settings).then(minified => {
        if (settings.callback) {
          settings.callback(null, minified);
        }

        resolve(minified);
      }).catch(err => {
        if (settings.callback) {
          settings.callback(err);
        }

        reject(err);
      });
    } else {
      const minified = method(settings);

      if (settings.callback) {
        settings.callback(null, minified);
      }

      resolve(minified);
    }
  });
};
/**
 * Expose `minify()`.
 */


module.exports = minify;