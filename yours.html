<!doctype html>
<html>

<head>
    <title>Your Podcasts - listenr</title>
    <!--metatags-->
    <link rel="manifest" href="manifest.json">
    <link rel="shortcut icon" href="icon-192.png">
    <meta charset="UTF-8">
    <meta name="description" content="The simplest podcatcher of them all">
    <meta name="image" content="icon-512.png">
    <meta itemprop="name" content="Listenr">
    <meta itemprop="description" content="The simplest podcatcher of them all">
    <meta itemprop="image" content="icon-512.png">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Listenr">
    <meta name="twitter:description" content="The simplest podcatcher of them all">
    <meta name="twitter:image:src" content="icon-512.png">
    <meta name="og:title" content="Listenr">
    <meta name="og:description" content="The simplest podcatcher of them all">
    <meta name="og:image" content="icon-512.png">
    <meta name="og:url" content="https://listenr.gq/">
    <meta name="og:site_name" content="Listenr">
    <meta name="og:locale" content="en_US">
    <meta name="og:type" content="website">
    <link rel="apple-touch-icon" href="apple-touch-icon.png" rel="preload">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <!--no more metatags-->
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@beta/dist/js.cookie.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mozilla/localForage@master/dist/localforage.js"></script>
    <link rel="stylesheet" href="view.css">
    <link href="https://fonts.googleapis.com/css?family=Poppins:300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1, height=device-height" />
    <script>
        var user;
        var shows = [];
        var showingthing = false;
        var exp = { expires: 100000 };
        function htmltotext(html) {
            document.getElementById("texttester").innerHTML = html;
            var b = document.getElementById("texttester").innerText || document.getElementById("texttester").textContent;
            return b;
        }
        function safe_decode(uri) {
            if (!uri) {
                return uri
            }
            try {
                return decodeURIComponent(uri.replace(/%(?![0-9][0-9a-fA-F]+)/gi, '%25'))
            }
            catch {
                return decodeURIComponent(uri)
            }
        }
        async function init() {
            if (Cookies.get("user") != null && Cookies.get("usingindexed") == null) {
                user = JSON.parse(Cookies.get("user"));
                Cookies.set("usingindexed", "true", exp)
                localforage.setItem("user", JSON.stringify(user)).then(() => {
                    console.log("put user into forage");
                });
            }
            else if (Cookies.get("usingindexed") == "true") {
                user = await localforage.getItem("user")
                user = JSON.parse(user)
            }
            else {
                user = {
                    subscribed: []
                };
                Cookies.set("usingindexed", "true", exp)
                localforage.setItem("user", JSON.stringify(user))
            }
            if ("serviceWorker" in navigator) {
                navigator.serviceWorker
                    .register("cache.js")
                    .then(function () { console.log("service worker registered"); });
            }
            if (user != null && user != {}) {
                if (user.subscribed.length > 0) {
                    var ephtml;
                    for (var i = 0; i < user.subscribed.length; i++) {
                        if (typeof user.subscribed[i].desc != "string") {
                            user.subscribed[i].desc = user.subscribed[i].desc[0]
                        }
                        ephtml = document.getElementById("show-$$i%%").outerHTML;
                        ephtml = ephtml.replace(/\$\$i\%\%/gi, i);
                        ephtml = ephtml.replace(/\$\$\%\%TOTITLE\%\%/gi, safe_decode(user.subscribed[i].title));
                        if (safe_decode(user.subscribed[i].desc).length > 250) {
                            ephtml = ephtml.replace(/\$\$\%\%DESK\%\%/gi, htmltotext(safe_decode(String(user.subscribed[i].desc).slice(0, 250))) + "... <i class='shortlong' onclick='showmore(" + i + ")'>more</i>");
                        }
                        else {
                            ephtml = ephtml.replace(/\$\$\%\%DESK\%\%/gi, htmltotext(safe_decode(user.subscribed[i].desc)));
                        }
                        ephtml = ephtml.replace(/\$\$PDI\%\%/gi, safe_decode(user.subscribed[i].img));
                        ephtml = ephtml.replace(/\$\$showurl\%\%/gi, "view.html?AetBh69feedbH=" + window.btoa(safe_decode(user.subscribed[i].url)));
                        document.getElementById("op").innerHTML += ephtml;
                        shows.push({
                            title: safe_decode(user.subscribed[i].title),
                            desc: safe_decode(user.subscribed[i].desc)
                        });
                    }
                    document.getElementById("show-$$i%%").style.display = "none";
                }
                else {
                    document.getElementById("op").innerHTML = `<p class='centererror'>Your're not subscribed to any shows. You can add one by <input name="AetBh69SERCH99bH2" id="AetBh69SERCH99bH2"  placeholder="Searching" onkeypress="csearch2(event)" autocomplete="off" type="text" style='margin-left: 10px;'></p>`;
                }
            }
            else {
                document.getElementById("op").innerHTML = "<p class='centererror'>Your're not subscribed to any shows. You can add one by searching</p>";
            }
            setTimeout(() => {
                document.getElementById("op").classList.remove("hidden");

            }, 100)
        }
        function csearch(data) {
            if (data.keyCode == 13) {
                console.log("aaa")
                window.location = "search.html?AetBh69SERCH99bH=" + (document.getElementById("AetBh69SERCH99bHm").value || document.getElementById("AetBh69SERCH99bH").value);
            }
        }
        function csearch2(data) {
            if (data.keyCode == 13) {
                window.location = "search.html?AetBh69SERCH99bH=" + document.getElementById("AetBh69SERCH99bH2").value;
            }
        }
        function showmore(i) {
            showingthing = true;
            document.getElementById("desc_" + i).innerHTML = shows[i].desc + "<br><br><i class='shortlong' onclick='showless(" + i + ")'>less</i>";
            document.getElementById("title_" + i).innerHTML = episodes[i].title;
            setTimeout(() => { showingthing = false }, 10);
        }
        function showless(i) {
            showingthing = true;
            document.getElementById("desc_" + i).innerHTML = htmltotext(shows[i].desc.replace(/<br>/gi, "\n").slice(0, 250)) + "... <i class='shortlong' onclick='showmore(" + i + ")'>more</i>";
            setTimeout(() => { showingthing = false }, 10);
        }
        function checkrss(data) {
            if (data.keyCode == 13) {
                if (document.getElementById("mobileside").classList.contains("leftside")) {
                    window.location = "view.html?AetBh69feedbH=" + window.btoa(document.getElementById("rssurl").value);
                }
                else {
                    window.location = "view.html?AetBh69feedbH=" + window.btoa(document.getElementById("rssurlm").value);
                }
            }
        }
        function savecookies() {
            Cookies.set("usingindexed", "true", exp)
            localforage.setItem("user", JSON.stringify(user)).then(() => {
                console.log("saved stuff");
            });
        }
        function dodropthing(a) {
            a.preventDefault();
            var data = a.dataTransfer.getData("text");
            var d = a.target.id;
            var idofogi = data.replace(/show-/gi, "");
            idofogi = idofogi.replace(/title_/gi, "");
            idofogi = idofogi.replace(/desc_/gi, "");
            idofogi = Number(idofogi);
            d = d.replace(/show-/gi, "");
            d = d.replace(/title_/gi, "");
            d = d.replace(/desc_/gi, "");
            if (d != "op") {
                d = Number(d);
            }
            if (idofogi > d && typeof d == "number") {
                user.subscribed.splice(d, 0, user.subscribed[idofogi]);
                user.subscribed.splice(idofogi + 1, 1);
            }
            else if (typeof d == "number") {
                user.subscribed.splice(d + 1, 0, user.subscribed[idofogi]);
                user.subscribed.splice(idofogi, 1);
            }
            else {
                var y = a.clientY;
                var ita;
                for (i in shows) {
                    if (y >= document.getElementById("show-" + i).getBoundingClientRect().y && y <= document.getElementById("show-" + (i + 1)).getBoundingClientRect().y) {
                        ita = i;
                        break;
                    }
                }
                user.subscribed.splice(ita + 1, 0, user.subscribed[idofogi]);
                if (ita > idofogi) {
                    user.subscribed.splice(idofogi, 1);
                }
                else {
                    user.subscribed.splice(idofogi + 1, 1);
                }
                console.log(idofogi);
            }
            savecookies();
            document.getElementById("op").innerHTML = document.getElementById("show-$$i%%").outerHTML;
            shows = [];
            document.getElementById("op").classList.add("hidden");
            document.getElementById("show-$$i%%").style.display = "";
            init();
        }
        function dodragthing(a) {
            a.dataTransfer.setData('text', a.target.id);
        }
        function hidemnav() {
            document.getElementById("mobileside").classList.add("leftside")
        }
        function showmnav() {
            document.getElementById("mobileside").classList.remove("leftside")
        }
    </script>
</head>

<body onload="init()">
    <div id="navbar">
        <span id="logopan" onclick="window.location='index.html'">
            <img src="listenr-logo.png" height="70"
                style="display: inline-block; vertical-align: middle; margin-top: -15px;">
        </span>
        <span class="navigation" onclick="window.location='yours.html'"
            style="font-weight: 700; font-size: 19px; color: white;">Your Podcasts</span> <span class="navigation"
            onclick="window.location='view.html'">View Show</span> <input name="AetBh69SERCH99bH" id="AetBh69SERCH99bH"
            placeholder="Search for a podcast..." onkeypress="csearch(event)" autocomplete="off" type="text">
        <span id="hidinput"><i style="margin-right: 5px;">or</i> <input placeholder="Add by RSS..."
                onkeypress="checkrss(event)" autocomplete="off" type="url" id="rssurl"></span>
    </div>
    <div id="mobilenav">
        <div class="burger" onclick="showmnav()"></div>

        <span id="logopan" onclick="window.location='index.html'">
            <img src="listenr-logo.png" height="60"
                style="display: inline-block; vertical-align: middle; margin-top: -20px;">
    </div>
    <div id="mobileside" class="leftside">
        <div class="burgerx" onclick="hidemnav()"><i class="fas fa-times"></i></div>
        <img src="listenr-logo.png" height="60"
            style="display: inline-block; vertical-align: middle; margin-top: -20px;">
        <br><br>
        <span class="navigation" style="font-weight: 700; font-size: 19px; color: white;">Your Podcasts</span>
        <span class="navigation" onclick="window.location='view.html'">View Show</span>
        <input name="AetBh69SERCH99bH" id="AetBh69SERCH99bHm" placeholder="Search for a podcast..."
            onkeypress="csearch(event)" autocomplete="off" type="text">
        <input placeholder="Add by RSS..." onkeypress="checkrss(event)" autocomplete="off" type="url" id="rssurlm">
    </div>
    <div id="nav-space"></div>
    <div id="op" class="hidden" ondragover="event.preventDefault()" ondrop="dodropthing(event)">
        <div class="episode show" onclick="if(!showingthing){window.location='$$showurl%%'}" id="show-$$i%%"
            draggable="true" ondragstart="dodragthing(event)">
            <img src="$$PDI%%" class="showim" draggable="false">

            <h1 class="episode_title" style="display: inline;" id="title_$$i%%"> $$%%TOTITLE%%</h1><br>
            <div id="desc_$$i%%">$$%%DESK%%</div>
        </div>
    </div>
    <div id="texttester" style="display: none; visibility: hidden;"></div>
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5f0cba4ead99598d"
        defer></script>
</body>

</html>